{% extends "base.html" %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
{% block title %}Utilities{% endblock %}

{% block content %}
<div class="container-fluid" style="padding: 0;">
    <h1>Water/Wastewater Utility Rates</h1>

    <!-- Add Utility Button -->
    <div class="mb-3">
        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addUtilityModal">
            Add Utility
        </button>
        <a href="{{ url_for('main.export_utilities') }}" class="btn btn-secondary">Export to CSV</a>
    </div>

    <!-- Responsive Table Wrapper -->
    <div class="table-responsive">
        <table id="utilityTable" class="table table-bordered table-striped" style="width: 100%;">
            <thead>
                <tr>
                    <th>Actions</th>
                    <th>City</th>
                    <th>State</th>
                    <th>Is Client</th>
                    <th>Population</th>
                    <th>Winter Avg.</th>
                    <th>Meter Size</th>
                    <th>Effective Date</th>
                    <th>Water Min Bill</th>
                    <!-- Water Blocks -->
                    <th>Water Block 1 Gallons</th>
                    <th>Water Block 2 Gallons</th>
                    <th>Water Block 3 Gallons</th>
                    <th>Water Block 4 Gallons</th>
                    <th>Water Block 5 Gallons</th>
                    <th>Water Block 6 Gallons</th>
                    <th>Water Block 7 Gallons</th>
                    <th>Water Block 8 Gallons</th>
                    <th>Water Block 9 Gallons</th>
                    <th>Water Block 10 Gallons</th>
                    <th>Water Block 1 Rates</th>
                    <th>Water Block 2 Rates</th>
                    <th>Water Block 3 Rates</th>
                    <th>Water Block 4 Rates</th>
                    <th>Water Block 5 Rates</th>
                    <th>Water Block 6 Rates</th>
                    <th>Water Block 7 Rates</th>
                    <th>Water Block 8 Rates</th>
                    <th>Water Block 9 Rates</th>
                    <th>Water Block 10 Rates</th>
                    <!-- Wastewater Blocks -->
                    <th>Water Block 1 Gallons</th>
                    <th>Water Block 2 Gallons</th>
                    <th>Water Block 3 Gallons</th>
                    <th>Water Block 4 Gallons</th>
                    <th>Water Block 5 Gallons</th>
                    <th>Water Block 6 Gallons</th>
                    <th>Water Block 7 Gallons</th>
                    <th>Water Block 8 Gallons</th>
                    <th>Water Block 9 Gallons</th>
                    <th>Water Block 10 Gallons</th>
                    <th>Water Block 1 Rates</th>
                    <th>Water Block 2 Rates</th>
                    <th>Water Block 3 Rates</th>
                    <th>Water Block 4 Rates</th>
                    <th>Water Block 5 Rates</th>
                    <th>Water Block 6 Rates</th>
                    <th>Water Block 7 Rates</th>
                    <th>Water Block 8 Rates</th>
                    <th>Water Block 9 Rates</th>
                    <th>Water Block 10 Rates</th>
                    <th>Source</th>
                </tr>
            </thead>
            <tbody>
                {% for utility in utilities %}
                <tr>
                    <td>
                        <div class="btn-group">
                            <!-- Edit Utility Button -->
                            <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#updateUtilityModal"
                                    data-id="{{ utility.id }}" data-city="{{ utility.city }}" data-state="{{ utility.state }}"
                                    data-client="{{ utility.client }}" data-population="{{ utility.population }}"
                                    data-winter_avg="{{ utility.winter_avg }}" data-meter_size="{{ utility.meter_size }}"
                                    data-effective_date="{{ utility.effective_date.strftime('%Y-%m-%d') if utility.effective_date else '' }}"
                                    data-source="{{ utility.source }}" data-w_min_bill="{{ utility.w_min_bill }}"
                                    data-ww_min_bill="{{ utility.ww_min_bill }}"
                                    data-w_block_1_gals="{{ utility.w_block_1_gals }}" data-w_block_1_rate="{{ utility.w_block_1_rate }}"
                                    data-w_block_2_gals="{{ utility.w_block_2_gals }}" data-w_block_2_rate="{{ utility.w_block_2_rate }}"
                                    data-w_block_3_gals="{{ utility.w_block_3_gals }}" data-w_block_3_rate="{{ utility.w_block_3_rate }}"
                                    data-w_block_4_gals="{{ utility.w_block_4_gals }}" data-w_block_4_rate="{{ utility.w_block_4_rate }}"
                                    data-w_block_5_gals="{{ utility.w_block_5_gals }}" data-w_block_5_rate="{{ utility.w_block_5_rate }}"
                                    data-w_block_6_gals="{{ utility.w_block_6_gals }}" data-w_block_6_rate="{{ utility.w_block_6_rate }}"
                                    data-w_block_7_gals="{{ utility.w_block_7_gals }}" data-w_block_7_rate="{{ utility.w_block_7_rate }}"
                                    data-w_block_8_gals="{{ utility.w_block_8_gals }}" data-w_block_8_rate="{{ utility.w_block_8_rate }}"
                                    data-w_block_9_gals="{{ utility.w_block_9_gals }}" data-w_block_9_rate="{{ utility.w_block_9_rate }}"
                                    data-w_block_10_gals="{{ utility.w_block_10_gals }}" data-w_block_10_rate="{{ utility.w_block_10_rate }}"
                                    data-ww_block_1_gals="{{ utility.ww_block_1_gals }}" data-ww_block_1_rate="{{ utility.ww_block_1_rate }}"
                                    data-ww_block_2_gals="{{ utility.ww_block_2_gals }}" data-ww_block_2_rate="{{ utility.ww_block_2_rate }}"
                                    data-ww_block_3_gals="{{ utility.ww_block_3_gals }}" data-ww_block_3_rate="{{ utility.ww_block_3_rate }}"
                                    data-ww_block_4_gals="{{ utility.ww_block_4_gals }}" data-ww_block_4_rate="{{ utility.ww_block_4_rate }}"
                                    data-ww_block_5_gals="{{ utility.ww_block_5_gals }}" data-ww_block_5_rate="{{ utility.ww_block_5_rate }}"
                                    data-ww_block_6_gals="{{ utility.ww_block_6_gals }}" data-ww_block_6_rate="{{ utility.ww_block_6_rate }}"
                                    data-ww_block_7_gals="{{ utility.ww_block_7_gals }}" data-ww_block_7_rate="{{ utility.ww_block_7_rate }}"
                                    data-ww_block_8_gals="{{ utility.ww_block_8_gals }}" data-ww_block_8_rate="{{ utility.ww_block_8_rate }}"
                                    data-ww_block_9_gals="{{ utility.ww_block_9_gals }}" data-ww_block_9_rate="{{ utility.ww_block_9_rate }}"
                                    data-ww_block_10_gals="{{ utility.ww_block_10_gals }}" data-ww_block_10_rate="{{ utility.ww_block_10_rate }}">
                                Edit
                            </button>

                            <!-- Delete Utility Button -->
                            <form action="{{ url_for('main.delete_utility', id=utility.id) }}" method="POST">
                                <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this utility?');">
                                    Delete
                                </button>
                            </form>
                        </div>
                    </td>
                    <td>{{ utility.city }}</td>
                    <td>{{ utility.state }}</td>
                    <td>{{ utility.client }}</td>
                    <td>{{ utility.population }}</td>
                    <td>{{ utility.winter_avg }}</td>
                    <td>{{ utility.meter_size }}</td>
                    <td>{{ utility.effective_date.strftime('%Y-%m-%d') if utility.effective_date else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_min_bill) if utility.w_min_bill else '' }}</td>
                    <!-- Water Blocks -->
                    <td>{{ utility.w_block_1_gals }}</td>
                    <td>{{ utility.w_block_2_gals }}</td>
                    <td>{{ utility.w_block_3_gals }}</td>
                    <td>{{ utility.w_block_4_gals }}</td>
                    <td>{{ utility.w_block_5_gals }}</td>
                    <td>{{ utility.w_block_6_gals }}</td>
                    <td>{{ utility.w_block_7_gals }}</td>
                    <td>{{ utility.w_block_8_gals }}</td>
                    <td>{{ utility.w_block_9_gals }}</td>
                    <td>{{ utility.w_block_10_gals }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_block_1_rate) if utility.w_block_1_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_block_2_rate) if utility.w_block_2_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_block_3_rate) if utility.w_block_3_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_block_4_rate) if utility.w_block_4_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_block_5_rate) if utility.w_block_5_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_block_6_rate) if utility.w_block_6_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_block_7_rate) if utility.w_block_7_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_block_8_rate) if utility.w_block_8_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_block_9_rate) if utility.w_block_9_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.w_block_10_rate) if utility.w_block_10_rate else '' }}</td>
                    <!-- Wastewater Blocks -->
                    <td>{{ utility.ww_block_1_gals }}</td>
                    <td>{{ utility.ww_block_2_gals }}</td>
                    <td>{{ utility.ww_block_3_gals }}</td>
                    <td>{{ utility.ww_block_4_gals }}</td>
                    <td>{{ utility.ww_block_5_gals }}</td>
                    <td>{{ utility.ww_block_6_gals }}</td>
                    <td>{{ utility.ww_block_7_gals }}</td>
                    <td>{{ utility.ww_block_8_gals }}</td>
                    <td>{{ utility.ww_block_9_gals }}</td>
                    <td>{{ utility.ww_block_10_gals }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.ww_block_1_rate) if utility.ww_block_1_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.ww_block_2_rate) if utility.ww_block_2_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.ww_block_3_rate) if utility.ww_block_3_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.ww_block_4_rate) if utility.ww_block_4_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.ww_block_5_rate) if utility.ww_block_5_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.ww_block_6_rate) if utility.ww_block_6_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.ww_block_7_rate) if utility.ww_block_7_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.ww_block_8_rate) if utility.ww_block_8_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.ww_block_9_rate) if utility.ww_block_9_rate else '' }}</td>
                    <td>{{ "$" + "{:,.2f}".format(utility.ww_block_10_rate) if utility.ww_block_10_rate else '' }}</td>
                    <td>
                        {% if utility.source %}
                        <a href="{{ utility.source }}" target="_blank">{{ utility.source }}</a>
                        {% else %}
                        N/A
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Add Utility Modal -->
<div class="modal fade" id="addUtilityModal" tabindex="-1" aria-labelledby="addUtilityModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addUtilityModalLabel">Add Utility</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addUtilityForm" method="POST" action="{{ url_for('main.add_utility') }}">
                    <!-- First Row: City, State, Population -->
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="city">City</label>
                                <input type="text" class="form-control" id="modal_add_city" name="city" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="state">State</label>
                                <input type="text" class="form-control" id="modal_add_state" name="state" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="population">Population</label>
                                <input type="number" class="form-control" id="modal_add_population" name="population">
                            </div>
                        </div>
                    </div>

                    <!-- Second Row: Is Client, Meter Size, Winter Avg., Effective Date -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="client">Is Client</label>
                                <select class="form-control" id="modal_add_client" name="client">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="meter_size">Meter Size</label>
                                <input type="text" class="form-control" id="modal_add_meter_size" name="meter_size">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="winter_avg">Winter Avg.</label>
                                <input type="text" class="form-control" id="modal_add_winter_avg" name="winter_avg">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="effective_date">Effective Date</label>
                                <input type="date" class="form-control" id="modal_add_effective_date" name="effective_date">
                            </div>
                        </div>
                    </div>

                    <!-- Third Row: Source -->
                    <div class="form-group">
                        <label for="source">Source</label>
                        <input type="text" class="form-control" id="modal_add_source" name="source">
                    </div>

                    <!-- Fourth Row: Water Min Bill, Wastewater Min Bill -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="w_min_bill">Water Min Bill</label>
                                <input type="number" step="0.01" class="form-control" id="modal_add_w_min_bill" name="w_min_bill">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="ww_min_bill">Wastewater Min Bill</label>
                                <input type="number" step="0.01" class="form-control" id="modal_add_ww_min_bill" name="ww_min_bill">
                            </div>
                        </div>
                    </div>

                    <!-- Block Fields: Two Columns Layout -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="w_block_1_gals">Water Block 1 Gallons</label>
                                <input type="number" class="form-control" id="modal_add_w_block_1_gals" name="w_block_1_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_2_gals">Water Block 2 Gallons</label>
                                <input type="number" class="form-control" id="modal_add_w_block_2_gals" name="w_block_2_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_3_gals">Water Block 3 Gallons</label>
                                <input type="number" class="form-control" id="modal_add_w_block_3_gals" name="w_block_3_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_4_gals">Water Block 4 Gallons</label>
                                <input type="number" class="form-control" id="modal_add_w_block_4_gals" name="w_block_4_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_5_gals">Water Block 5 Gallons</label>
                                <input type="number" class="form-control" id="modal_add_w_block_5_gals" name="w_block_5_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_6_gals">Water Block 6 Gallons</label>
                                <input type="number" class="form-control" id="modal_add_w_block_6_gals" name="w_block_6_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_7_gals">Water Block 7 Gallons</label>
                                <input type="number" class="form-control" id="modal_add_w_block_7_gals" name="w_block_7_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_8_gals">Water Block 8 Gallons</label>
                                <input type="number" class="form-control" id="modal_add_w_block_8_gals" name="w_block_8_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_9_gals">Water Block 9 Gallons</label>
                                <input type="number" class="form-control" id="modal_add_w_block_9_gals" name="w_block_9_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_10_gals">Water Block 10 Gallons</label>
                                <input type="number" class="form-control" id="modal_add_w_block_10_gals" name="w_block_10_gals">
                                <!-- Repeat similar blocks for other water and wastewater blocks (gallons) -->
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="w_block_1_rate">Water Block 1 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_w_block_1_rate" name="w_block_1_rate">
                                </div>
                                <div class="form-group">
                                    <label for="w_block_2_rate">Water Block 2 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_w_block_2_rate" name="w_block_2_rate">
                                </div>
                                <div class="form-group">
                                    <label for="w_block_3_rate">Water Block 3 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_w_block_3_rate" name="w_block_3_rate">
                                </div>
                                <div class="form-group">
                                    <label for="w_block_4_rate">Water Block 4 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_w_block_4_rate" name="w_block_4_rate">
                                </div>
                                <div class="form-group">
                                    <label for="w_block_5_rate">Water Block 5 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_w_block_5_rate" name="w_block_5_rate">
                                </div>
                                <div class="form-group">
                                    <label for="w_block_6_rate">Water Block 6 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_w_block_6_rate" name="w_block_6_rate">
                                </div>
                                <div class="form-group">
                                    <label for="w_block_7_rate">Water Block 7 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_w_block_7_rate" name="w_block_7_rate">
                                </div>
                                <div class="form-group">
                                    <label for="w_block_8_rate">Water Block 8 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_w_block_8_rate" name="w_block_8_rate">
                                </div>
                                <div class="form-group">
                                    <label for="w_block_9_rate">Water Block 9 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_w_block_9_rate" name="w_block_9_rate">
                                </div>
                                <div class="form-group">
                                    <label for="w_block_10_rate">Water Block 10 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_w_block_10_rate" name="w_block_10_rate">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="ww_block_1_gals">Waste Block 1 Gallons</label>
                                    <input type="number" class="form-control" id="modal_add_ww_block_1_gals" name="ww_block_1_gals">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_2_gals">Waste Block 2 Gallons</label>
                                    <input type="number" class="form-control" id="modal_add_ww_block_2_gals" name="ww_block_2_gals">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_3_gals">Waste Block 3 Gallons</label>
                                    <input type="number" class="form-control" id="modal_add_ww_block_3_gals" name="ww_block_3_gals">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_4_gals">Waste Block 4 Gallons</label>
                                    <input type="number" class="form-control" id="modal_add_ww_block_4_gals" name="ww_block_4_gals">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_5_gals">Waste Block 5 Gallons</label>
                                    <input type="number" class="form-control" id="modal_add_ww_block_5_gals" name="ww_block_5_gals">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_6_gals">Waste Block 6 Gallons</label>
                                    <input type="number" class="form-control" id="modal_add_ww_block_6_gals" name="ww_block_6_gals">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_7_gals">Waste Block 7 Gallons</label>
                                    <input type="number" class="form-control" id="modal_add_ww_block_7_gals" name="ww_block_7_gals">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_8_gals">Waste Block 8 Gallons</label>
                                    <input type="number" class="form-control" id="modal_add_ww_block_8_gals" name="ww_block_8_gals">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_9_gals">Waste Block 9 Gallons</label>
                                    <input type="number" class="form-control" id="modal_add_ww_block_9_gals" name="ww_block_9_gals">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_10_gals">Waste Block 10 Gallons</label>
                                    <input type="number" class="form-control" id="modal_add_ww_block_10_gals" name="ww_block_10_gals">
                                </div>
                                <!-- Repeat similar blocks for other water and wastewater blocks (gallons) -->
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="ww_block_1_rate">Waste Block 1 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_ww_block_1_rate" name="ww_block_1_rate">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_2_rate">Waste Block 2 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_ww_block_2_rate" name="ww_block_2_rate">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_3_rate">Waste Block 3 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_ww_block_3_rate" name="ww_block_3_rate">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_4_rate">Waste Block 4 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_ww_block_4_rate" name="ww_block_4_rate">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_5_rate">Waste Block 5 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_ww_block_5_rate" name="ww_block_5_rate">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_6_rate">Waste Block 6 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_ww_block_6_rate" name="ww_block_6_rate">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_7_rate">Waste Block 7 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_ww_block_7_rate" name="ww_block_7_rate">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_8_rate">Waste Block 8 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_ww_block_8_rate" name="ww_block_8_rate">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_9_rate">Waste Block 9 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_ww_block_9_rate" name="ww_block_9_rate">
                                </div>
                                <div class="form-group">
                                    <label for="ww_block_10_rate">Waste Block 10 Rate</label>
                                    <input type="number" step="0.01" class="form-control" id="modal_add_ww_block_10_rate" name="ww_block_10_rate">
                                </div>
                            </div>
                            <!-- Repeat similar blocks for other water and wastewater blocks (rates) -->
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary mt-3">Add Utility</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Update Utility Modal -->
<!-- Modal -->
<div class="modal fade" id="updateUtilityModal" tabindex="-1" aria-labelledby="updateUtilityModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateUtilityModalLabel">Update Utility</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="updateUtilityForm" method="POST" action="">
                    <!-- First Row: City, State, Population -->
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="city">City</label>
                                <input type="text" class="form-control" id="modal_city" name="city" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="state">State</label>
                                <input type="text" class="form-control" id="modal_state" name="state" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="population">Population</label>
                                <input type="number" class="form-control" id="modal_population" name="population">
                            </div>
                        </div>
                    </div>

                    <!-- Second Row: Is Client, Meter Size, Winter Avg., Effective Date -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="client">Is Client</label>
                                <select class="form-control" id="modal_client" name="client">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="meter_size">Meter Size</label>
                                <input type="text" class="form-control" id="modal_meter_size" name="meter_size">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="winter_avg">Winter Avg.</label>
                                <select class="form-control" id="modal_winter_avg" name="winter_avg">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="effective_date">Effective Date</label>
                                <input type="date" class="form-control" id="modal_effective_date" name="effective_date">
                            </div>
                        </div>
                    </div>


                    <!-- Third Row: Source -->
                    <div class="form-group">
                        <label for="source">Source</label>
                        <input type="text" class="form-control" id="modal_source" name="source">
                    </div>

                    <!-- Fourth Row: Water Min Bill, Wastewater Min Bill -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="w_min_bill">Water Min Bill</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_min_bill" name="w_min_bill">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="ww_min_bill">Wastewater Min Bill</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_min_bill" name="ww_min_bill">
                            </div>
                        </div>
                    </div>

                    <!-- Block Fields: Two Columns Layout -->
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="w_block_1_gals">Water Block 1 Gallons</label>
                                <input type="number" class="form-control" id="modal_w_block_1_gals" name="w_block_1_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_2_gals">Water Block 2 Gallons</label>
                                <input type="number" class="form-control" id="modal_w_block_2_gals" name="w_block_2_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_3_gals">Water Block 3 Gallons</label>
                                <input type="number" class="form-control" id="modal_w_block_3_gals" name="w_block_3_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_4_gals">Water Block 4 Gallons</label>
                                <input type="number" class="form-control" id="modal_w_block_4_gals" name="w_block_4_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_5_gals">Water Block 5 Gallons</label>
                                <input type="number" class="form-control" id="modal_w_block_5_gals" name="w_block_5_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_6_gals">Water Block 6 Gallons</label>
                                <input type="number" class="form-control" id="modal_w_block_6_gals" name="w_block_6_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_7_gals">Water Block 7 Gallons</label>
                                <input type="number" class="form-control" id="modal_w_block_7_gals" name="w_block_7_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_8_gals">Water Block 8 Gallons</label>
                                <input type="number" class="form-control" id="modal_w_block_8_gals" name="w_block_8_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_9_gals">Water Block 9 Gallons</label>
                                <input type="number" class="form-control" id="modal_w_block_9_gals" name="w_block_9_gals">
                            </div>
                            <div class="form-group">
                                <label for="w_block_10_gals">Water Block 10 Gallons</label>
                                <input type="number" class="form-control" id="modal_w_block_10_gals" name="w_block_10_gals">
                            </div>
                            <!-- Repeat similar blocks for other water and wastewater blocks (gallons) -->
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="w_block_1_rate">Water Block 1 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_block_1_rate" name="w_block_1_rate">
                            </div>
                            <div class="form-group">
                                <label for="w_block_2_rate">Water Block 2 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_block_2_rate" name="w_block_2_rate">
                            </div>
                            <div class="form-group">
                                <label for="w_block_3_rate">Water Block 3 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_block_3_rate" name="w_block_3_rate">
                            </div>
                            <div class="form-group">
                                <label for="w_block_4_rate">Water Block 4 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_block_4_rate" name="w_block_4_rate">
                            </div>
                            <div class="form-group">
                                <label for="w_block_5_rate">Water Block 5 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_block_5_rate" name="w_block_5_rate">
                            </div>
                            <div class="form-group">
                                <label for="w_block_6_rate">Water Block 6 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_block_6_rate" name="w_block_6_rate">
                            </div>
                            <div class="form-group">
                                <label for="w_block_7_rate">Water Block 7 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_block_7_rate" name="w_block_7_rate">
                            </div>
                            <div class="form-group">
                                <label for="w_block_8_rate">Water Block 8 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_block_8_rate" name="w_block_8_rate">
                            </div>
                            <div class="form-group">
                                <label for="w_block_9_rate">Water Block 9 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_block_9_rate" name="w_block_9_rate">
                            </div>
                            <div class="form-group">
                                <label for="w_block_10_rate">Water Block 10 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_w_block_10_rate" name="w_block_10_rate">
                            </div>
                            <!-- Repeat similar blocks for other water and wastewater blocks (rates) -->
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="ww_block_1_gals">Waste Block 1 Gallons</label>
                                <input type="number" class="form-control" id="modal_ww_block_1_gals" name="ww_block_1_gals">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_2_gals">Waste Block 2 Gallons</label>
                                <input type="number" class="form-control" id="modal_ww_block_2_gals" name="ww_block_2_gals">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_3_gals">Waste Block 3 Gallons</label>
                                <input type="number" class="form-control" id="modal_ww_block_3_gals" name="ww_block_3_gals">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_4_gals">Waste Block 4 Gallons</label>
                                <input type="number" class="form-control" id="modal_ww_block_4_gals" name="ww_block_4_gals">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_5_gals">Waste Block 5 Gallons</label>
                                <input type="number" class="form-control" id="modal_ww_block_5_gals" name="ww_block_5_gals">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_6_gals">Waste Block 6 Gallons</label>
                                <input type="number" class="form-control" id="modal_ww_block_6_gals" name="ww_block_6_gals">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_7_gals">Waste Block 7 Gallons</label>
                                <input type="number" class="form-control" id="modal_ww_block_7_gals" name="ww_block_7_gals">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_8_gals">Waste Block 8 Gallons</label>
                                <input type="number" class="form-control" id="modal_ww_block_8_gals" name="ww_block_8_gals">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_9_gals">Waste Block 9 Gallons</label>
                                <input type="number" class="form-control" id="modal_ww_block_9_gals" name="ww_block_9_gals">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_10_gals">Waste Block 10 Gallons</label>
                                <input type="number" class="form-control" id="modal_ww_block_10_gals" name="ww_block_10_gals">
                            </div>
                            <!-- Repeat similar blocks for other water and wastewater blocks (gallons) -->
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="ww_block_1_rate">Waste Block 1 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_block_1_rate" name="ww_block_1_rate">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_2_rate">Waste Block 2 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_block_2_rate" name="ww_block_2_rate">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_3_rate">Waste Block 3 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_block_3_rate" name="ww_block_3_rate">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_4_rate">Waste Block 4 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_block_4_rate" name="ww_block_4_rate">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_5_rate">Waste Block 5 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_block_5_rate" name="ww_block_5_rate">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_6_rate">Waste Block 6 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_block_6_rate" name="ww_block_6_rate">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_7_rate">Waste Block 7 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_block_7_rate" name="ww_block_7_rate">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_8_rate">Waste Block 8 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_block_8_rate" name="ww_block_8_rate">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_9_rate">Waste Block 9 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_block_9_rate" name="ww_block_9_rate">
                            </div>
                            <div class="form-group">
                                <label for="ww_block_10_rate">Waste Block 10 Rate</label>
                                <input type="number" step="0.01" class="form-control" id="modal_ww_block_10_rate" name="ww_block_10_rate">
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary mt-3">Update Utility</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var updateUtilityModal = document.getElementById('updateUtilityModal');
        updateUtilityModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget; // Button that triggered the modal

            // Extract data from the button attributes
            var utilityId = button.getAttribute('data-id');
            var city = button.getAttribute('data-city');
            var state = button.getAttribute('data-state');
            var population = button.getAttribute('data-population');
            var client = button.getAttribute('data-client');
            var meter_size = button.getAttribute('data-meter_size');
            var winter_avg = button.getAttribute('data-winter_avg');
            var effective_date = button.getAttribute('data-effective_date');
            var source = button.getAttribute('data-source');
            var w_min_bill = button.getAttribute('data-w_min_bill');
            var ww_min_bill = button.getAttribute('data-ww_min_bill');

            var w_block_1_gals = button.getAttribute('data-w_block_1_gals');
            var w_block_1_rate = button.getAttribute('data-w_block_1_rate');
            var w_block_2_gals = button.getAttribute('data-w_block_2_gals');
            var w_block_2_rate = button.getAttribute('data-w_block_2_rate');
            var w_block_3_gals = button.getAttribute('data-w_block_3_gals');
            var w_block_3_rate = button.getAttribute('data-w_block_3_rate');
            var w_block_4_gals = button.getAttribute('data-w_block_4_gals');
            var w_block_4_rate = button.getAttribute('data-w_block_4_rate');
            var w_block_5_gals = button.getAttribute('data-w_block_5_gals');
            var w_block_5_rate = button.getAttribute('data-w_block_5_rate');
            var w_block_6_gals = button.getAttribute('data-w_block_6_gals');
            var w_block_6_rate = button.getAttribute('data-w_block_6_rate');
            var w_block_7_gals = button.getAttribute('data-w_block_7_gals');
            var w_block_7_rate = button.getAttribute('data-w_block_7_rate');
            var w_block_8_gals = button.getAttribute('data-w_block_8_gals');
            var w_block_8_rate = button.getAttribute('data-w_block_8_rate');
            var w_block_9_gals = button.getAttribute('data-w_block_9_gals');
            var w_block_9_rate = button.getAttribute('data-w_block_9_rate');
            var w_block_10_gals = button.getAttribute('data-w_block_10_gals');
            var w_block_10_rate = button.getAttribute('data-w_block_10_rate');
            var ww_block_1_gals = button.getAttribute('data-ww_block_1_gals');
            var ww_block_1_rate = button.getAttribute('data-ww_block_1_rate');
            var ww_block_2_gals = button.getAttribute('data-ww_block_2_gals');
            var ww_block_2_rate = button.getAttribute('data-ww_block_2_rate');
            var ww_block_3_gals = button.getAttribute('data-ww_block_3_gals');
            var ww_block_3_rate = button.getAttribute('data-ww_block_3_rate');
            var ww_block_4_gals = button.getAttribute('data-ww_block_4_gals');
            var ww_block_4_rate = button.getAttribute('data-ww_block_4_rate');
            var ww_block_5_gals = button.getAttribute('data-ww_block_5_gals');
            var ww_block_5_rate = button.getAttribute('data-ww_block_5_rate');
            var ww_block_6_gals = button.getAttribute('data-ww_block_6_gals');
            var ww_block_6_rate = button.getAttribute('data-ww_block_6_rate');
            var ww_block_7_gals = button.getAttribute('data-ww_block_7_gals');
            var ww_block_7_rate = button.getAttribute('data-ww_block_7_rate');
            var ww_block_8_gals = button.getAttribute('data-ww_block_8_gals');
            var ww_block_8_rate = button.getAttribute('data-ww_block_8_rate');
            var ww_block_9_gals = button.getAttribute('data-ww_block_9_gals');
            var ww_block_9_rate = button.getAttribute('data-ww_block_9_rate');
            var ww_block_10_gals = button.getAttribute('data-ww_block_10_gals');
            var ww_block_10_rate = button.getAttribute('data-ww_block_10_rate');
            // Add additional block attributes as needed

            // Update the form action dynamically
            var form = document.getElementById('updateUtilityForm');
            form.action = '/update_utility/' + utilityId;

            // Populate the modal form fields with the data
            form.querySelector('#modal_city').value = city;
            form.querySelector('#modal_state').value = state;
            form.querySelector('#modal_population').value = population;
            form.querySelector('#modal_client').value = client;
            form.querySelector('#modal_meter_size').value = meter_size;
            form.querySelector('#modal_winter_avg').value = winter_avg;
            form.querySelector('#modal_effective_date').value = effective_date;
            form.querySelector('#modal_source').value = source;
            form.querySelector('#modal_w_min_bill').value = w_min_bill;
            form.querySelector('#modal_ww_min_bill').value = ww_min_bill;
            form.querySelector('#modal_w_block_1_gals').value = w_block_1_gals;
            form.querySelector('#modal_w_block_1_rate').value = w_block_1_rate;
            form.querySelector('#modal_w_block_2_gals').value = w_block_2_gals;
            form.querySelector('#modal_w_block_2_rate').value = w_block_2_rate;
            form.querySelector('#modal_w_block_3_gals').value = w_block_3_gals;
            form.querySelector('#modal_w_block_3_rate').value = w_block_3_rate;
            form.querySelector('#modal_w_block_4_gals').value = w_block_4_gals;
            form.querySelector('#modal_w_block_4_rate').value = w_block_4_rate;
            form.querySelector('#modal_w_block_5_gals').value = w_block_5_gals;
            form.querySelector('#modal_w_block_5_rate').value = w_block_5_rate;
            form.querySelector('#modal_w_block_6_gals').value = w_block_6_gals;
            form.querySelector('#modal_w_block_6_rate').value = w_block_6_rate;
            form.querySelector('#modal_w_block_7_gals').value = w_block_7_gals;
            form.querySelector('#modal_w_block_7_rate').value = w_block_7_rate;
            form.querySelector('#modal_w_block_8_gals').value = w_block_8_gals;
            form.querySelector('#modal_w_block_8_rate').value = w_block_8_rate;
            form.querySelector('#modal_w_block_9_gals').value = w_block_9_gals;
            form.querySelector('#modal_w_block_9_rate').value = w_block_9_rate;
            form.querySelector('#modal_w_block_10_gals').value = w_block_10_gals;
            form.querySelector('#modal_w_block_10_rate').value = w_block_10_rate;
            form.querySelector('#modal_ww_block_1_gals').value = ww_block_1_gals;
            form.querySelector('#modal_ww_block_1_rate').value = ww_block_1_rate;
            form.querySelector('#modal_ww_block_2_gals').value = ww_block_2_gals;
            form.querySelector('#modal_ww_block_2_rate').value = ww_block_2_rate;
            form.querySelector('#modal_ww_block_3_gals').value = ww_block_3_gals;
            form.querySelector('#modal_ww_block_3_rate').value = ww_block_3_rate;
            form.querySelector('#modal_ww_block_4_gals').value = ww_block_4_gals;
            form.querySelector('#modal_ww_block_4_rate').value = ww_block_4_rate;
            form.querySelector('#modal_ww_block_5_gals').value = ww_block_5_gals;
            form.querySelector('#modal_ww_block_5_rate').value = ww_block_5_rate;
            form.querySelector('#modal_ww_block_6_gals').value = ww_block_6_gals;
            form.querySelector('#modal_ww_block_6_rate').value = ww_block_6_rate;
            form.querySelector('#modal_ww_block_7_gals').value = ww_block_7_gals;
            form.querySelector('#modal_ww_block_7_rate').value = ww_block_7_rate;
            form.querySelector('#modal_ww_block_8_gals').value = ww_block_8_gals;
            form.querySelector('#modal_ww_block_8_rate').value = ww_block_8_rate;
            form.querySelector('#modal_ww_block_9_gals').value = ww_block_9_gals;
            form.querySelector('#modal_ww_block_9_rate').value = ww_block_9_rate;
            form.querySelector('#modal_ww_block_10_gals').value = ww_block_10_gals;
            form.querySelector('#modal_ww_block_10_rate').value = ww_block_10_rate;
            // Repeat for additional blocks
        });
    });
</script>
<script>
    $(document).ready(function () {
        $('#utilityTable').DataTable({
            "paging": true,        // Enable pagination
            "ordering": true,      // Enable sorting
            "info": true,          // Show table information
            "searching": true      // Enable searching
        });
    });
</script>
{% endblock %}